# CMCC Coffee - 专业订单管理系统

## 项目简介
CMCC Coffee 是一个基于Flask的专业咖啡店订单管理系统，采用现代化的企业级界面设计，提供实时订单监控、声音提醒、弹窗通知和完整的订单状态管理功能。系统从本地Excel文件读取订单数据，每分钟自动刷新，无需外部依赖即可运行。

## 功能特性

### 🎯 核心功能
- **Excel数据读取** - 从本地Excel文件读取订单数据
- **自动数据刷新** - 每分钟自动刷新Excel数据
- **实时订单监控** - 每5秒自动刷新订单列表
- **新订单提醒** - 声音提示和弹窗通知
- **订单状态管理** - 接单、拒单、取消订单
- **专业界面设计** - 企业级管理后台界面
- **数据统计** - 订单数量和金额统计

### 📱 界面特性
- **现代化设计** - 专业的侧边栏导航和顶部状态栏
- **订单筛选标签** - 按状态分类查看订单
- **搜索筛选功能** - 支持订单号、手机号、时间范围搜索
- **数据表格展示** - 清晰的表格布局，支持排序和操作
- **响应式设计** - 支持各种屏幕尺寸
- **状态指示器** - 实时显示营业状态

### 🔔 提醒功能
- **声音提醒** - 新订单到达时播放提示音
- **弹窗通知** - 右上角显示通知消息
- **视觉反馈** - 新订单高亮显示
- **数量提醒** - 各状态订单数量实时更新

### 📊 数据功能
- **Excel数据源** - 从本地Excel文件读取订单数据
- **状态管理** - 完整的订单生命周期管理
- **统计信息** - 实时统计订单数量和金额
- **筛选功能** - 多维度订单筛选

## 技术栈
- **后端**: Flask 2.3.3
- **前端**: HTML5 + CSS3 + JavaScript
- **图标库**: Font Awesome 6.0
- **数据处理**: Pandas 2.0.3 + OpenPyXL 3.1.2
- **数据存储**: Excel文件（本地存储）
- **数据刷新**: 每分钟自动刷新

## Excel数据格式

### 必需列名
- `订单号`: 订单唯一标识
- `状态`: 2(待接单)、5(已完成)、6(已取消)
- `用户名`: 客户姓名
- `手机号`: 客户联系电话
- `地址`: 配送地址
- `金额`: 订单金额
- `备注`: 订单备注
- `下单时间`: 下单时间
- `菜品`: 菜品列表（用逗号分隔）

### 示例数据
```excel
订单号    | 状态 | 用户名 | 手机号       | 地址                    | 金额  | 备注 | 下单时间           | 菜品
ORDER001  | 2    | 张先生 | 13800138001 | 北京市朝阳区建国路88号 | 25.00| 少糖 | 2024-01-15 10:30:00| 美式咖啡,拿铁咖啡
```

## 安装和运行

### 1. 环境要求
- Python 3.7+

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 准备Excel数据
将Excel文件放在 `orders` 文件夹中，文件名格式为 `*.xlsx`

### 4. 启动系统

#### 从根目录启动（推荐）
```bash
# 在 Coffee 目录下运行
python start.py
```

#### 从项目目录启动
```bash
# 进入项目目录
cd CMCC_Coffe

# 方式1: 使用启动脚本（推荐，包含环境检查）
python start.py

# 方式2: 直接运行主程序
python main.py

# 方式3: 直接运行Flask应用（仅用于开发）
python app.py
```

**启动方式说明：**
- **根目录 start.py**: 最推荐方式，自动找到项目目录并启动
- **项目目录 start.py**: 推荐方式，会检查Python版本、依赖包、Excel文件等，启动后自动打开浏览器
- **main.py**: 直接启动，适合已知环境正常的情况，启动后自动打开浏览器
- **app.py**: 仅用于开发调试，不会进行初始化，需要手动打开浏览器

### 5. 访问系统
打开浏览器访问: http://localhost:5000

## 测试数据

### 生成测试数据
```bash
# 生成简单测试数据（推荐）
python generate_simple_test_data.py

# 生成完整测试数据
python generate_test_data.py
```

### 测试数据内容
- **简单测试数据**: 5个订单，覆盖所有状态
- **完整测试数据**: 10个订单，更丰富的测试场景
- **数据位置**: `orders/simple_test_orders.xlsx` 或 `orders/test_orders.xlsx`

### 验证数据读取
```bash
# 快速测试数据读取
python quick_test.py
```

## 系统配置

### Excel文件配置
在 `app.py` 中可以修改以下配置：
```python
EXCEL_FOLDER = "orders"  # Excel文件存放文件夹
EXCEL_PATTERN = "*.xlsx"  # Excel文件匹配模式
```

### 数据刷新配置
```python
# 修改刷新间隔（秒）
time.sleep(60)  # 每60秒刷新一次
```

## 订单状态说明

| 状态值 | 状态名称 | 说明 |
|--------|----------|------|
| 2 | 待接单 | 已支付，等待商家接单 |
| 5 | 已完成 | 订单已完成 |
| 6 | 已取消 | 订单已取消 |

## 操作流程

### 订单处理流程
1. **Excel数据更新** → 系统自动读取最新Excel文件
2. **查看订单详情** → 显示客户信息、地址、金额等
3. **接单/拒单** → 对待接单订单进行操作
4. **完成订单** → 接单后订单自动变为已完成

### 操作按钮说明
- **接单** - 接受订单，状态变为"已完成"
- **拒单** - 拒绝订单，状态变为"已取消"
- **取消** - 取消已完成订单，状态变为"已取消"
- **查看** - 查看订单详细信息

## 界面功能

### 筛选功能
- **全部订单**: 显示所有订单
- **待接单**: 显示待接单订单
- **已完成**: 显示已完成订单
- **已取消**: 显示已取消订单

### 搜索功能
- **订单号搜索**: 按订单号精确搜索
- **手机号搜索**: 按客户手机号搜索
- **时间范围搜索**: 按下单时间范围搜索

### 表格功能
- **固定表头**: 滚动时表头保持可见
- **行交替背景**: 提高可读性
- **悬停效果**: 鼠标悬停高亮显示
- **操作按钮**: 每行显示相应的操作按钮

## API接口

### 主要接口
1. **GET /api/orders** - 获取待接单订单
2. **GET /api/orders/all** - 获取所有订单
3. **POST /api/order/{id}/{action}** - 更新订单状态
4. **GET /api/statistics** - 获取统计信息
5. **GET /api/orders/{status}** - 根据状态获取订单
6. **GET /api/excel-info** - 获取Excel文件信息

## 故障排除

### 常见问题

1. **Excel文件读取失败**
   - 确保Excel文件为`.xlsx`格式
   - 检查文件是否损坏
   - 验证列名是否正确

2. **数据乱码**
   - 使用 `generate_simple_test_data.py` 重新生成测试数据
   - 确保Excel文件使用UTF-8编码

3. **端口被占用**
   - 修改 `app.py` 中的端口号
   - 检查5000端口是否被其他程序占用

4. **依赖安装失败**
   - 确保Python版本为3.7+
   - 使用虚拟环境安装依赖

### 调试模式
启动时添加调试信息：
```python
app.run(debug=True, host='0.0.0.0', port=5000)
```

## 项目结构
```
CMCC_Coffe/
├── main.py                   # 主入口文件（启动逻辑）
├── app.py                    # Flask应用（API路由和业务逻辑）
├── start.py                  # 启动脚本（环境检查）
├── requirements.txt          # Python依赖
├── README.md                # 说明文档
├── 测试数据说明.md          # 测试数据说明
├── generate_simple_test_data.py  # 简单测试数据生成
├── generate_test_data.py     # 完整测试数据生成
├── quick_test.py            # 快速测试脚本
├── orders/                  # Excel文件目录
│   ├── simple_test_orders.xlsx  # 简单测试数据
│   └── 订单模板.xlsx        # Excel模板说明
└── templates/
    └── index.html           # 主页面模板
```

## 文件职责说明

### 核心文件
- **main.py**: 系统主入口，负责启动和初始化
- **app.py**: Flask应用核心，包含所有API路由和业务逻辑
- **start.py**: 启动脚本，负责环境检查和依赖验证

### 数据文件
- **generate_simple_test_data.py**: 生成简单测试数据
- **generate_test_data.py**: 生成完整测试数据
- **quick_test.py**: 快速测试Excel读取功能

### 配置文件
- **requirements.txt**: Python依赖包列表
- **orders/**: Excel数据文件目录

## 开发说明

### 添加新功能
1. 在 `app.py` 中添加新的路由和逻辑
2. 在 `templates/index.html` 中添加前端界面
3. 更新JavaScript代码处理新功能

### 自定义样式
修改 `templates/index.html` 中的CSS样式来自定义界面外观。

### 扩展API
可以在 `app.py` 中添加新的API端点来扩展功能。

### 数据持久化
当前使用Excel文件存储，可以扩展为数据库存储：
- SQLite: 轻量级数据库
- MySQL: 生产环境数据库
- Redis: 缓存数据库

## 许可证
本项目基于MIT许可证开源。

## 联系方式
如有问题或建议，请联系开发团队。 